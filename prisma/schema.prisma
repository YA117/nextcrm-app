// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Users {
  id                   String        @id @default(auto()) @map("_id") @db.ObjectId
  name                 String?
  email                String        @unique
  password             String?
  image                String?       @map("avatar")
  createdAt            DateTime      @default(now()) @map("created_on") @db.Date
  updatedAt            DateTime?     @updatedAt
  
  // Relations
  lists                InfluencerList[]
  campaigns            Campaign[]    @relation("CreatedCampaigns")
  managedCampaigns     Campaign[]    @relation("ManagedCampaigns")
  deliverables         Deliverable[] @relation("AssignedDeliverables")
  notes                Note[]
}

model Influencer {
  id                   String        @id @default(auto()) @map("_id") @db.ObjectId
  
  // Basic Info
  firstName            String?
  lastName             String?
  handle               String?       // Primary handle (e.g. IG)
  platform             Platform      @default(INSTAGRAM)
  avatar               String?
  bio                  String?
  location             String?
  verified             Boolean       @default(false)
  
  // Stats
  followers            Int           @default(0)
  following            Int           @default(0)
  engagementRate       Float         @default(0.0)
  averageLikes         Int           @default(0)
  averageComments      Int           @default(0)
  
  // Contact Info
  email                String?
  phone                String?
  website              String?
  
  // Niche/Categorization
  niche                String[]
  tags                 String[]
  
  // Rates
  ratePost             Int?
  rateStory            Int?
  rateReel             Int?
  rateVideo            Int?
  currency             String        @default("USD")
  
  // System
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  
  // Relations
  lists                InfluencerList[] @relation(fields: [listIds], references: [id])
  listIds              String[]      @db.ObjectId
  
  campaigns            CampaignInfluencer[]
  deliverables         Deliverable[]
  notes                Note[]
}

enum Platform {
  INSTAGRAM
  TIKTOK
  YOUTUBE
}

model InfluencerList {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  color       String?
  icon        String?
  isSmart     Boolean      @default(false)
  criteria    Json?        // For smart lists
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  userId      String       @db.ObjectId
  owner       Users        @relation(fields: [userId], references: [id])
  
  influencers Influencer[] @relation(fields: [influencerIds], references: [id])
  influencerIds String[]   @db.ObjectId
}

model Campaign {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?      // The Brief
  status      CampaignStatus @default(DRAFT)
  
  // Details
  brand       String?
  budget      Int?
  startDate   DateTime?
  endDate     DateTime?
  objectives  String[]
  
  // Assets
  fileUrls    String[]
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  ownerId     String       @db.ObjectId
  owner       Users        @relation("CreatedCampaigns", fields: [ownerId], references: [id])
  
  managerId   String?      @db.ObjectId
  manager     Users?       @relation("ManagedCampaigns", fields: [managerId], references: [id])
  
  influencers CampaignInfluencer[]
  deliverables Deliverable[]
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

model CampaignInfluencer {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  
  campaign     Campaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  campaignId   String       @db.ObjectId
  
  influencer   Influencer   @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  influencerId String       @db.ObjectId
  
  status       CollaborationStatus @default(INVITED)
  
  // Influencer specific terms for this campaign
  agreedRate   Int?
  notes        String?
  
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  
  @@unique([campaignId, influencerId])
}

enum CollaborationStatus {
  INVITED
  ACCEPTED
  DECLINED
  IN_PROGRESS
  COMPLETED
  UNRESPONSIVE
}

model Deliverable {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  
  title        String       // e.g. "IG Post 1"
  description  String?      // Requirements
  platform     Platform
  contentType  String       // Post, Story, Reel, etc.
  
  dueDate      DateTime?
  postUrl      String?
  
  status       DeliverableStatus @default(NOT_STARTED)
  
  // Media
  submissionUrl String?     // The draft content
  submissionText String?    // Caption draft
  
  // Performance
  likes        Int?
  comments     Int?
  shares       Int?
  views        Int?
  postedAt     DateTime?
  
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  
  campaign     Campaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  campaignId   String       @db.ObjectId
  
  influencer   Influencer   @relation(fields: [influencerId], references: [id])
  influencerId String       @db.ObjectId
  
  authorId     String?      @db.ObjectId // Who created this deliverable requirement
  author       Users?       @relation("AssignedDeliverables", fields: [authorId], references: [id])
}

enum DeliverableStatus {
  NOT_STARTED
  IN_PROGRESS
  SUBMITTED
  CHANGES_REQUESTED
  APPROVED
  POSTED
}

model Note {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  content      String
  
  createdAt    DateTime     @default(now())
  
  author       Users        @relation(fields: [authorId], references: [id])
  authorId     String       @db.ObjectId
  
  influencer   Influencer?  @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  influencerId String?      @db.ObjectId
}
